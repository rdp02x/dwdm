# 6. Create a Snowflake Schema

> Design and implement a snowflake schema for a university admission system, and compare it with a star schema.

> University Admission System: Track and analyze student admissions, departments, programs, locations, and time dimensions.

---

## 1. Snowflake Schema Design

**Fact Table:**
- FactAdmissions: Stores admission-related facts like number of students, admission score, etc.

**Dimension Tables (Snowflaked):**
- DimStudent (normalized with DimLocation)
- DimProgram (normalized with DimDepartment, DimFaculty)
- DimDate

---

## Snowflake Schema Diagram (Text Representation)

```
              +----------------+
              |  DimLocation   |
              +----------------+
                      ▲
                      |
              +----------------+
              |  DimStudent    |
              +----------------+
                       ▲
                       |
+----------------+     |     +------------------+
| DimDepartment  |<----+---->|   DimProgram     |
+----------------+           +------------------+
         ▲                            ▲
         |                            |
  +---------------+           +------------------+
  |  DimFaculty   |           |    DimDate       |
  +---------------+           +------------------+

            --------------------------
            |     FactAdmissions     |
            --------------------------
```

---

## 2. SQL Code for Snowflake Schema

### 2.1 Dimension Tables

#### DimLocation

```sql
CREATE TABLE DimLocation (
    LocationID INT PRIMARY KEY,
    City VARCHAR(50),
    State VARCHAR(50),
    Country VARCHAR(50)
);
```

#### DimStudent

```sql
CREATE TABLE DimStudent (
    StudentID INT PRIMARY KEY,
    StudentName VARCHAR(100),
    Gender CHAR(1),
    Age INT,
    LocationID INT,
    FOREIGN KEY (LocationID) REFERENCES DimLocation(LocationID)
);
```

#### DimFaculty

```sql
CREATE TABLE DimFaculty (
    FacultyID INT PRIMARY KEY,
    FacultyName VARCHAR(100)
);
```

#### DimDepartment

```sql
CREATE TABLE DimDepartment (
    DepartmentID INT PRIMARY KEY,
    DepartmentName VARCHAR(100),
    FacultyID INT,
    FOREIGN KEY (FacultyID) REFERENCES DimFaculty(FacultyID)
);
```

#### DimProgram

```sql
CREATE TABLE DimProgram (
    ProgramID INT PRIMARY KEY,
    ProgramName VARCHAR(100),
    Level VARCHAR(50),  -- UG/PG
    DepartmentID INT,
    FOREIGN KEY (DepartmentID) REFERENCES DimDepartment(DepartmentID)
);
```

#### DimDate

```sql
CREATE TABLE DimDate (
    DateID INT PRIMARY KEY,
    FullDate DATE,
    Month INT,
    Quarter VARCHAR(10),
    Year INT
);
```

---

### 2.2 Fact Table

```sql
CREATE TABLE FactAdmissions (
    AdmissionID INT PRIMARY KEY,
    StudentID INT,
    ProgramID INT,
    DateID INT,
    AdmissionScore DECIMAL(5,2),
    ScholarshipAmount DECIMAL(10,2),

    FOREIGN KEY (StudentID) REFERENCES DimStudent(StudentID),
    FOREIGN KEY (ProgramID) REFERENCES DimProgram(ProgramID),
    FOREIGN KEY (DateID) REFERENCES DimDate(DateID)
);
```

---

## 3. Sample Inserts

### Location

```sql
INSERT INTO DimLocation VALUES (1, 'Chennai', 'Tamil Nadu', 'India');
```

### Student

```sql
INSERT INTO DimStudent VALUES (1001, 'Arjun R', 'M', 18, 1);
```

### Faculty

```sql
INSERT INTO DimFaculty VALUES (10, 'Engineering');
```

### Department

```sql
INSERT INTO DimDepartment VALUES (20, 'Computer Science', 10);
```

### Program

```sql
INSERT INTO DimProgram VALUES (30, 'B.Tech CS', 'UG', 20);
```

### Date

```sql
INSERT INTO DimDate VALUES (101, '2025-06-20', 6, 'Q2', 2025);
```

### Admission

```sql
INSERT INTO FactAdmissions VALUES (5001, 1001, 30, 101, 87.5, 20000);
```

---

## 4. Example OLAP Queries

### Total admissions by department:

```sql
SELECT D.DepartmentName, COUNT(*) AS TotalAdmissions
FROM FactAdmissions F
JOIN DimProgram P ON F.ProgramID = P.ProgramID
JOIN DimDepartment D ON P.DepartmentID = D.DepartmentID
GROUP BY D.DepartmentName;
```

### Average score by city:

```sql
SELECT L.City, AVG(F.AdmissionScore) AS AvgScore
FROM FactAdmissions F
JOIN DimStudent S ON F.StudentID = S.StudentID
JOIN DimLocation L ON S.LocationID = L.LocationID
GROUP BY L.City;
```

---

## 5. Snowflake vs Star Schema Comparison

| **Aspect** | **Star Schema** | **Snowflake Schema** |
|------------|-----------------|---------------------|
| **Normalization** | Denormalized dimensions | Normalized dimensions |
| **Query Complexity** | Simple (fewer joins) | Complex (more joins) |
| **Storage** | More redundancy | Less redundancy |
| **Query Performance** | Faster | Slower (more joins) |
| **Maintenance** | Harder to update | Easier to update |
| **Use Case** | OLAP, reporting | When storage is critical |
