# 5. Design and Implement a Mini Data Warehouse

> Choose a domain (e.g., hospital, university, airline) and build a schema including fact and dimension tables.

---

## 1. Create Dimension Tables

### Patient Dimension

```sql
CREATE TABLE DimPatient (
    PatientID INT PRIMARY KEY,
    Name VARCHAR(100),
    Gender CHAR(1),
    Age INT,
    City VARCHAR(50)
);
```

### Doctor Dimension

```sql
CREATE TABLE DimDoctor (
    DoctorID INT PRIMARY KEY,
    DoctorName VARCHAR(100),
    Specialization VARCHAR(50)
);
```

### Department Dimension

```sql
CREATE TABLE DimDepartment (
    DepartmentID INT PRIMARY KEY,
    DepartmentName VARCHAR(50)
);
```

### Date Dimension

```sql
CREATE TABLE DimDate (
    DateID INT PRIMARY KEY,
    FullDate DATE,
    Day INT,
    Month INT,
    Quarter VARCHAR(10),
    Year INT
);
```

### Diagnosis Dimension

```sql
CREATE TABLE DimDiagnosis (
    DiagnosisID INT PRIMARY KEY,
    DiagnosisName VARCHAR(100),
    Treatment VARCHAR(100)
);
```

---

## 2. Create Fact Table

```sql
CREATE TABLE FactPatientVisits (
    VisitID INT PRIMARY KEY,
    PatientID INT,
    DoctorID INT,
    DepartmentID INT,
    DateID INT,
    DiagnosisID INT,
    BillAmount DECIMAL(10, 2),

    FOREIGN KEY (PatientID) REFERENCES DimPatient(PatientID),
    FOREIGN KEY (DoctorID) REFERENCES DimDoctor(DoctorID),
    FOREIGN KEY (DepartmentID) REFERENCES DimDepartment(DepartmentID),
    FOREIGN KEY (DateID) REFERENCES DimDate(DateID),
    FOREIGN KEY (DiagnosisID) REFERENCES DimDiagnosis(DiagnosisID)
);
```

---

## 3. Sample Data Insertion

### Patients

```sql
INSERT INTO DimPatient VALUES
(1, 'John Doe', 'M', 35, 'Chennai'),
(2, 'Jane Smith', 'F', 29, 'Delhi');
```

### Doctors

```sql
INSERT INTO DimDoctor VALUES
(101, 'Dr. Kumar', 'Cardiology'),
(102, 'Dr. Meena', 'Neurology');
```

### Departments

```sql
INSERT INTO DimDepartment VALUES
(201, 'Cardiology'),
(202, 'Neurology');
```

### Dates

```sql
INSERT INTO DimDate VALUES
(301, '2025-07-01', 1, 7, 'Q3', 2025),
(302, '2025-07-15', 15, 7, 'Q3', 2025);
```

### Diagnoses

```sql
INSERT INTO DimDiagnosis VALUES
(401, 'Hypertension', 'Medication'),
(402, 'Migraine', 'Therapy');
```

### Fact Table

```sql
INSERT INTO FactPatientVisits VALUES
(501, 1, 101, 201, 301, 401, 1500.00),
(502, 2, 102, 202, 302, 402, 2000.00);
```

---

## 4. Example Queries (OLAP-style)

### Total billing by department:

```sql
SELECT D.DepartmentName, SUM(F.BillAmount) AS TotalRevenue
FROM FactPatientVisits F
JOIN DimDepartment D ON F.DepartmentID = D.DepartmentID
GROUP BY D.DepartmentName;
```

### Number of patients per diagnosis:

```sql
SELECT Di.DiagnosisName, COUNT(DISTINCT F.PatientID) AS PatientCount
FROM FactPatientVisits F
JOIN DimDiagnosis Di ON F.DiagnosisID = Di.DiagnosisID
GROUP BY Di.DiagnosisName;
```

### Revenue by doctor per quarter:

```sql
SELECT Doc.DoctorName, Da.Quarter, SUM(F.BillAmount) AS Revenue
FROM FactPatientVisits F
JOIN DimDoctor Doc ON F.DoctorID = Doc.DoctorID
JOIN DimDate Da ON F.DateID = Da.DateID
GROUP BY Doc.DoctorName, Da.Quarter;
```
