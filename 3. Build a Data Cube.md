 # 3. Build a Data Cube

> Use SQL Server Analysis Services (SSAS) or Oracle to create a data cube for product sales and perform slicing and dicing operations.

---

## Step 1: Prepare the Data in SQL Server

### Dimension Table: Product

```sql
CREATE TABLE DimProduct (
    ProductID INT PRIMARY KEY,
    ProductName VARCHAR(100),
    Category VARCHAR(50)
);
```

### Dimension Table: Date

```sql
CREATE TABLE DimDate (
    DateID INT PRIMARY KEY,
    FullDate DATE,
    MonthName VARCHAR(20),
    Quarter VARCHAR(10),
    Year INT
);
```

### Fact Table: Sales

```sql
CREATE TABLE FactSales (
    SalesID INT PRIMARY KEY,
    ProductID INT FOREIGN KEY REFERENCES DimProduct(ProductID),
    DateID INT FOREIGN KEY REFERENCES DimDate(DateID),
    SalesAmount DECIMAL(10, 2),
    QuantitySold INT
);
```

### Insert Sample Data

```sql
INSERT INTO DimProduct VALUES
(1, 'Laptop', 'Electronics'),
(2, 'Headphones', 'Accessories'),
(3, 'Desk Chair', 'Furniture');
```

```sql
INSERT INTO DimDate VALUES
(101, '2025-01-15', 'January', 'Q1', 2025),
(102, '2025-02-20', 'February', 'Q1', 2025),
(103, '2025-04-10', 'April', 'Q2', 2025);
```

```sql
INSERT INTO FactSales VALUES
(1001, 1, 101, 1000.00, 2),
(1002, 2, 102, 150.00, 5),
(1003, 3, 103, 250.00, 1);
```

---

## Step 2: Create SSAS Multidimensional Project in SSDT (Visual Studio)

- Open SQL Server Data Tools (SSDT).
- Create a new project:
  **Type:** Analysis Services Multidimensional and Data Mining Project.
- Define Data Source: Connect to your SQL Server database where tables are stored.
- Create Data Source View (DSV): Add `DimProduct`, `DimDate`, `FactSales` to DSV.
- Ensure relationships:
  - `FactSales.ProductID` → `DimProduct.ProductID`
  - `FactSales.DateID` → `DimDate.DateID`

---

## Step 3: Define Dimensions

Create two dimensions:

**Product Dimension**
- Attributes: `ProductName`, `Category`

**Date Dimension**
- Attributes: `MonthName`, `Quarter`, `Year`

---

## Step 4: Create the Cube

- Create new cube.
- Select `FactSales` as Measure Group.
- Measures: `SalesAmount`, `QuantitySold`
- Add Dimensions: `Product`, `Date`

---

## Step 5: Deploy and Process the Cube

- Right-click the project → **Deploy**.
- Right-click → **Process the cube** (load data into the cube).
- Use SQL Server Management Studio (SSMS) to browse the cube.

---

## Step 6: Perform Slicing and Dicing (Using MDX)

### Slice: Get total sales for "Laptop" only

```mdx
SELECT 
  {[Measures].[SalesAmount]} ON COLUMNS,
  {[DimProduct].[ProductName].&[Laptop]} ON ROWS
FROM [SalesCube]
```

### Dice: Get sales by product and year

```mdx
SELECT 
  {[Measures].[SalesAmount]} ON COLUMNS,
  NON EMPTY 
  CrossJoin(
    [DimProduct].[ProductName].[ProductName].Members, 
    [DimDate].[Year].[Year].Members
  ) ON ROWS
FROM [SalesCube]
```

---

### Step 1: Prepare the Data in SQL Server

**Dimension Table: Product**

```sql
CREATE TABLE DimProduct (
    ProductID INT PRIMARY KEY,
    ProductName VARCHAR(100),
    Category VARCHAR(50)
);
```

**Dimension Table: Date**

```sql
CREATE TABLE DimDate (
    DateID INT PRIMARY KEY,
    FullDate DATE,
    MonthName VARCHAR(20),
    Quarter VARCHAR(10),
    Year INT
);
```

**Fact Table: Sales**

```sql
CREATE TABLE FactSales (
    SalesID INT PRIMARY KEY,
    ProductID INT FOREIGN KEY REFERENCES DimProduct(ProductID),
    DateID INT FOREIGN KEY REFERENCES DimDate(DateID),
    SalesAmount DECIMAL(10, 2),
    QuantitySold INT
);
```

**Insert Sample Data**

```sql
INSERT INTO DimProduct VALUES
(1, 'Laptop', 'Electronics'),
(2, 'Headphones', 'Accessories'),
(3, 'Desk Chair', 'Furniture');

INSERT INTO DimDate VALUES
(101, '2025-01-15', 'January', 'Q1', 2025),
(102, '2025-02-20', 'February', 'Q1', 2025),
(103, '2025-04-10', 'April', 'Q2', 2025);

INSERT INTO FactSales VALUES
(1001, 1, 101, 1000.00, 2),
(1002, 2, 102, 150.00, 5),
(1003, 3, 103, 250.00, 1);
```

---

### Step 2: Create SSAS Multidimensional Project in SSDT (Visual Studio)

- Open SQL Server Data Tools (SSDT).
    
- Create a new project:  
    **Type:** Analysis Services Multidimensional and Data Mining Project.
    
- Define Data Source: Connect to your SQL Server database where tables are stored.
    
- Create Data Source View (DSV): Add `DimProduct`, `DimDate`, `FactSales` to DSV.
    
- Ensure relationships:
    
    - `FactSales.ProductID` → `DimProduct.ProductID`
        
    - `FactSales.DateID` → `DimDate.DateID`
        

---

### Step 3: Define Dimensions

- Create two dimensions:
    
    **Product Dimension**  
    Attributes: `ProductName`, `Category`
    
    **Date Dimension**  
    Attributes: `MonthName`, `Quarter`, `Year`
    

---

### Step 4: Create the Cube

- Create new cube.
    
- Select `FactSales` as Measure Group.
    
- Measures: `SalesAmount`, `QuantitySold`
    
- Add Dimensions: `Product`, `Date`
    

---

### Step 5: Deploy and Process the Cube

- Right-click the project → **Deploy**.
    
- Right-click → **Process the cube** (load data into the cube).
    
- Use SQL Server Management Studio (SSMS) to browse the cube.
    

---

### Step 6: Perform Slicing and Dicing (Using MDX)

**Slice: Get total sales for “Laptop” only**

```sql
SELECT 
  {[Measures].[SalesAmount]} ON COLUMNS,
  {[DimProduct].[ProductName].&[Laptop]} ON ROWS
FROM [SalesCube]
```

**Dice: Get sales by product and year**

```sql
SELECT 
  {[Measures].[SalesAmount]} ON COLUMNS,
  NON EMPTY 
  CrossJoin(
    [DimProduct].[ProductName].[ProductName].Members, 
    [DimDate].[Year].[Year].Members
  ) ON ROWS
FROM [SalesCube]
```

