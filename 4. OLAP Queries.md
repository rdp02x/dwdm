# 4. OLAP Queries> Use SQL to perform OLAP operations (Roll-up, Drill-down, Slice, Dice, Pivot) on a data warehouse built from a movie rental dataset.



> Use SQL to perform OLAP operations (Roll-up, Drill-down, Slice, Dice, Pivot) on a data warehouse built from a movie rental dataset.---



---### Dimension Tables



## Dimension Tables**Movie Dimension**



### Movie Dimension```sql

CREATE TABLE DimMovie (

```sql    MovieID INT PRIMARY KEY,

CREATE TABLE DimMovie (    Title VARCHAR(100),

    MovieID INT PRIMARY KEY,    Genre VARCHAR(50),

    Title VARCHAR(100),    ReleaseYear INT

    Genre VARCHAR(50),);

    ReleaseYear INT```

);

```**Customer Dimension**



### Customer Dimension```sql

CREATE TABLE DimCustomer (

```sql    CustomerID INT PRIMARY KEY,

CREATE TABLE DimCustomer (    Name VARCHAR(100),

    CustomerID INT PRIMARY KEY,    City VARCHAR(50),

    Name VARCHAR(100),    AgeGroup VARCHAR(20)

    City VARCHAR(50),);

    AgeGroup VARCHAR(20)```

);

```**Date Dimension**



### Date Dimension```sql

CREATE TABLE DimDate (

```sql    DateID INT PRIMARY KEY,

CREATE TABLE DimDate (    FullDate DATE,

    DateID INT PRIMARY KEY,    MonthName VARCHAR(20),

    FullDate DATE,    Year INT,

    MonthName VARCHAR(20),    Quarter VARCHAR(10)

    Year INT,);

    Quarter VARCHAR(10)```

);

```---



---### Fact Table



## Fact Table**Rental Fact Table**



### Rental Fact Table```sql

CREATE TABLE FactRental (

```sql    RentalID INT PRIMARY KEY,

CREATE TABLE FactRental (    MovieID INT,

    RentalID INT PRIMARY KEY,    CustomerID INT,

    MovieID INT,    DateID INT,

    CustomerID INT,    RentalAmount DECIMAL(8,2),

    DateID INT,    FOREIGN KEY (MovieID) REFERENCES DimMovie(MovieID),

    RentalAmount DECIMAL(8,2),    FOREIGN KEY (CustomerID) REFERENCES DimCustomer(CustomerID),

    FOREIGN KEY (MovieID) REFERENCES DimMovie(MovieID),    FOREIGN KEY (DateID) REFERENCES DimDate(DateID)

    FOREIGN KEY (CustomerID) REFERENCES DimCustomer(CustomerID),);

    FOREIGN KEY (DateID) REFERENCES DimDate(DateID)```

);

```---



---### OLAP Operations with SQL



## OLAP Operations with SQL**1. ROLL-UP**  

Total rental amount rolled up by Genre → Year

### 1. ROLL-UP

```sql

Total rental amount rolled up by Genre → YearSELECT 

    Genre, 

```sql    Year, 

SELECT     SUM(RentalAmount) AS TotalRental

    Genre, FROM FactRental F

    Year, JOIN DimMovie M ON F.MovieID = M.MovieID

    SUM(RentalAmount) AS TotalRentalJOIN DimDate D ON F.DateID = D.DateID

FROM FactRental FGROUP BY ROLLUP (Genre, Year);

JOIN DimMovie M ON F.MovieID = M.MovieID```

JOIN DimDate D ON F.DateID = D.DateID

GROUP BY ROLLUP (Genre, Year);**2. DRILL-DOWN**  

```Drill down from Genre to specific Movies in 2025



### 2. DRILL-DOWN```sql

SELECT 

Drill down from Genre to specific Movies in 2025    Genre, 

    Title, 

```sql    SUM(RentalAmount) AS TotalRental

SELECT FROM FactRental F

    Genre, JOIN DimMovie M ON F.MovieID = M.MovieID

    Title, JOIN DimDate D ON F.DateID = D.DateID

    SUM(RentalAmount) AS TotalRentalWHERE D.Year = 2025

FROM FactRental FGROUP BY Genre, Title;

JOIN DimMovie M ON F.MovieID = M.MovieID```

JOIN DimDate D ON F.DateID = D.DateID

WHERE D.Year = 2025**3. SLICE**  

GROUP BY Genre, Title;Slice the data for rentals made in 'Action' genre only

```

```sql

### 3. SLICESELECT 

    Title, 

Slice the data for rentals made in 'Action' genre only    SUM(RentalAmount) AS TotalRental

FROM FactRental F

```sqlJOIN DimMovie M ON F.MovieID = M.MovieID

SELECT WHERE Genre = 'Action'

    Title, GROUP BY Title;

    SUM(RentalAmount) AS TotalRental```

FROM FactRental F

JOIN DimMovie M ON F.MovieID = M.MovieID**4. DICE**  

WHERE Genre = 'Action'Get rental amounts for ‘Comedy’ or ‘Action’ genres AND customers in the age group '18-25' during the year 2025

GROUP BY Title;

``````sql

SELECT 

### 4. DICE    Genre, 

    AgeGroup, 

Get rental amounts for 'Comedy' or 'Action' genres AND customers in the age group '18-25' during the year 2025    Year,

    SUM(RentalAmount) AS TotalRental

```sqlFROM FactRental F

SELECT JOIN DimMovie M ON F.MovieID = M.MovieID

    Genre, JOIN DimCustomer C ON F.CustomerID = C.CustomerID

    AgeGroup, JOIN DimDate D ON F.DateID = D.DateID

    Year,WHERE Genre IN ('Comedy', 'Action')

    SUM(RentalAmount) AS TotalRental  AND AgeGroup = '18-25'

FROM FactRental F  AND Year = 2025

JOIN DimMovie M ON F.MovieID = M.MovieIDGROUP BY Genre, AgeGroup, Year;

JOIN DimCustomer C ON F.CustomerID = C.CustomerID```

JOIN DimDate D ON F.DateID = D.DateID

WHERE Genre IN ('Comedy', 'Action')**5. PIVOT**

  AND AgeGroup = '18-25'

  AND Year = 2025_SQL Server example using PIVOT operator_

GROUP BY Genre, AgeGroup, Year;

``````sql

SELECT *

### 5. PIVOTFROM (

    SELECT 

#### SQL Server example using PIVOT operator        Genre, 

        Year, 

```sql        RentalAmount

SELECT *    FROM FactRental F

FROM (    JOIN DimMovie M ON F.MovieID = M.MovieID

    SELECT     JOIN DimDate D ON F.DateID = D.DateID

        Genre, ) AS SourceTable

        Year, PIVOT (

        RentalAmount    SUM(RentalAmount)

    FROM FactRental F    FOR Year IN ([2023], [2024], [2025])

    JOIN DimMovie M ON F.MovieID = M.MovieID) AS PivotTable;

    JOIN DimDate D ON F.DateID = D.DateID```

) AS SourceTable

PIVOT (_For PostgreSQL or Oracle, use CASE WHEN style pivot:_

    SUM(RentalAmount)

    FOR Year IN ([2023], [2024], [2025])```sql

) AS PivotTable;SELECT 

```    Genre,

    SUM(CASE WHEN Year = 2023 THEN RentalAmount ELSE 0 END) AS "2023",

#### For PostgreSQL or Oracle, use CASE WHEN style pivot:    SUM(CASE WHEN Year = 2024 THEN RentalAmount ELSE 0 END) AS "2024",

    SUM(CASE WHEN Year = 2025 THEN RentalAmount ELSE 0 END) AS "2025"

```sqlFROM FactRental F

SELECT JOIN DimMovie M ON F.MovieID = M.MovieID

    Genre,JOIN DimDate D ON F.DateID = D.DateID

    SUM(CASE WHEN Year = 2023 THEN RentalAmount ELSE 0 END) AS "2023",GROUP BY Genre;

    SUM(CASE WHEN Year = 2024 THEN RentalAmount ELSE 0 END) AS "2024",```

    SUM(CASE WHEN Year = 2025 THEN RentalAmount ELSE 0 END) AS "2025"

FROM FactRental F
JOIN DimMovie M ON F.MovieID = M.MovieID
JOIN DimDate D ON F.DateID = D.DateID
GROUP BY Genre;
```
