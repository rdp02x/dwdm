# 13. Outlier Detection13. Outlier Detection

Identify outliers in a dataset using distance-based 

> Identify outliers in a dataset using distance-based methods or Z-score analysis. Visualize the result using scatter plots.methods or Z-score analysis. Visualize the result 

using scatter plots.

---import numpy as np

import pandas as pd

## Python Implementationimport matplotlib.pyplot as plt

from sklearn.neighbors import NearestNeighbors

### Import Librariesfrom scipy.stats import zscore

Step 1: Create synthetic dataset

```pythonnp.random.seed(42)

import numpy as npGenerate normal cluster of points

import pandas as pd

import matplotlib.pyplot as plt

from sklearn.neighbors import NearestNeighbors

from scipy.stats import zscorex = np.random.normal(5, 1, 100)

```y = np.random.normal(5, 1, 100)

Add some clear outliers

### Step 1: Create Synthetic Datasetx_outliers = np.random.uniform(10, 15, 5)

y_outliers = np.random.uniform(10, 15, 5)

```pythonCombine data

np.random.seed(42)x = np.concatenate([x, x_outliers])

y = np.concatenate([y, y_outliers])

# Generate normal cluster of pointsdata = pd.DataFrame({"x": x, "y": y})

x = np.random.normal(5, 1, 100)Method 1: Z-Score Analysis

y = np.random.normal(5, 1, 100)z_scores = np.abs(zscore(data))  # compute z-

scores for each column

# Add some clear outliersoutliers_z = (z_scores > 3).any(axis=1)  # mark as 

x_outliers = np.random.uniform(10, 15, 5)outlier if z > 3

y_outliers = np.random.uniform(10, 15, 5)Method 2: Distance-Based Outlier Detection 

(kNN)

# Combine datanbrs = NearestNeighbors(n_neighbors=5).fit(data)

x = np.concatenate([x, x_outliers])distances, indices = nbrs.kneighbors(data)

y = np.concatenate([y, y_outliers])mean distance to k nearest neighbors



data = pd.DataFrame({"x": x, "y": y})

print(data.head())

```mean_distances = distances.mean(axis=1)

threshold = np.percentile(mean_distances, 95)  # 

---top 5% distances = outliers

outliers_dist = mean_distances > threshold

## Method 1: Z-Score AnalysisVisualization

fig, axes = plt.subplots(1, 2, figsize=(12, 5))

```pythonZ-score method plot

# Compute z-scores for each columnaxes[0].scatter(data["x"], data["y"], c="blue", 

z_scores = np.abs(zscore(data))label="Normal")

axes[0].scatter(data[outliers_z]["x"], 

# Mark as outlier if z > 3data[outliers_z]["y"], c="red", label="Outliers")

outliers_z = (z_scores > 3).any(axis=1)axes[0].set_title("Outlier Detection using Z-

Score")

print(f"Number of outliers detected (Z-score): {outliers_z.sum()}")axes[0].legend()

```Distance-based method plot

axes[1].scatter(data["x"], data["y"], c="blue", 

---label="Normal")

axes[1].scatter(data[outliers_dist]["x"], 

## Method 2: Distance-Based Outlier Detection (kNN)data[outliers_dist]["y"], c="orange", 

label="Outliers")

```python

# Fit k-nearest neighbors

nbrs = NearestNeighbors(n_neighbors=5).fit(data)

distances, indices = nbrs.kneighbors(data)axes[1].set_title("Outlier Detection using 

Distance-Based Method")

# Mean distance to k nearest neighborsaxes[1].legend()

mean_distances = distances.mean(axis=1)plt.show()

What this does:

# Top 5% distances = outliersCreates a dataset with a cluster + outliers.

threshold = np.percentile(mean_distances, 95) 

outliers_dist = mean_distances > thresholdDetects outliers with:

Z-score (statistical method, threshold = 3)

print(f"Number of outliers detected (Distance-based): {outliers_dist.sum()}")Distance-based (kNN) (points far from neighbors 

```are flagged).

Visualizes both methods side-by-side using scatter 

---plots.



## Visualization

```python
fig, axes = plt.subplots(1, 2, figsize=(12, 5))

# Z-score method plot
axes[0].scatter(data["x"], data["y"], c="blue", label="Normal", alpha=0.6)
axes[0].scatter(
    data[outliers_z]["x"], 
    data[outliers_z]["y"], 
    c="red", 
    label="Outliers", 
    s=100, 
    edgecolors='black'
)
axes[0].set_title("Outlier Detection using Z-Score")
axes[0].set_xlabel("X")
axes[0].set_ylabel("Y")
axes[0].legend()
axes[0].grid(True, alpha=0.3)

# Distance-based method plot
axes[1].scatter(data["x"], data["y"], c="blue", label="Normal", alpha=0.6)
axes[1].scatter(
    data[outliers_dist]["x"], 
    data[outliers_dist]["y"], 
    c="orange", 
    label="Outliers", 
    s=100, 
    edgecolors='black'
)
axes[1].set_title("Outlier Detection using Distance-Based Method")
axes[1].set_xlabel("X")
axes[1].set_ylabel("Y")
axes[1].legend()
axes[1].grid(True, alpha=0.3)

plt.tight_layout()
plt.show()
```

---

## Using IQR (Interquartile Range) Method

```python
def detect_outliers_iqr(df, column):
    Q1 = df[column].quantile(0.25)
    Q3 = df[column].quantile(0.75)
    IQR = Q3 - Q1
    
    lower_bound = Q1 - 1.5 * IQR
    upper_bound = Q3 + 1.5 * IQR
    
    outliers = (df[column] < lower_bound) | (df[column] > upper_bound)
    return outliers

# Detect outliers using IQR
outliers_iqr_x = detect_outliers_iqr(data, 'x')
outliers_iqr_y = detect_outliers_iqr(data, 'y')
outliers_iqr = outliers_iqr_x | outliers_iqr_y

print(f"Number of outliers detected (IQR): {outliers_iqr.sum()}")
```

### Visualize IQR Method

```python
plt.figure(figsize=(8, 6))
plt.scatter(data["x"], data["y"], c="blue", label="Normal", alpha=0.6)
plt.scatter(
    data[outliers_iqr]["x"], 
    data[outliers_iqr]["y"], 
    c="green", 
    label="Outliers (IQR)", 
    s=100, 
    edgecolors='black'
)
plt.title("Outlier Detection using IQR Method")
plt.xlabel("X")
plt.ylabel("Y")
plt.legend()
plt.grid(True, alpha=0.3)
plt.show()
```

---

## Summary

| **Method** | **Description** | **Best For** |
|------------|-----------------|-------------|
| **Z-Score** | Statistical method, threshold = 3 | Normally distributed data |
| **Distance-Based (kNN)** | Points far from neighbors | Non-normal distributions |
| **IQR** | Quartile-based outlier detection | Robust to extreme values |

### What This Does:
- Creates a dataset with a cluster + outliers.
- Detects outliers with:
  - **Z-score** (statistical method, threshold = 3)
  - **Distance-based (kNN)** (points far from neighbors are flagged)
  - **IQR** (Interquartile Range method)
- Visualizes all methods side-by-side using scatter plots.
